{"version":3,"sources":["../../../src/menu/src/makeMenuAccessible/makeMenuAccessible.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["/**\n  * Adds keyboard interaction to toggle menu. The menu traps focus and can be interacted with using the keyboard. The first interactive item of the menu has focus when menu open.\n  * @param {string} menuId - The id of the menu.\n  * @param {string} menuItemsClass - The class of the items that are children of the menu.\n  * @param {string} triggerId - The id of the button that triggers the menu.\n*/\n\nimport { handleKeyPress } from \"../../../utils/handleKeyPress/handleKeyPress\";\nimport { NodeListOfHTMLElement } from \"Types\";\n\n\nexport function makeMenuAccessible({ menuId, menuItemsClass, triggerId }: {menuId: string; menuItemsClass: string; triggerId: string;}) {\n  const menuDiv = document.querySelector(`#${menuId}`) as HTMLElement;\n  if (!menuDiv) {\n    console.error(`[aria-ease] Element with id=\"${menuId}\" not found. Make sure the menu element exists before calling makeMenuAccessible.`);\n    return { openMenu: () => {}, closeMenu: () => {}, cleanup: () => {} };\n  }\n\n  const triggerButton = document.querySelector(`#${triggerId}`) as HTMLElement;\n  if (!triggerButton) {\n    console.error(`[aria-ease] Element with id=\"${triggerId}\" not found. Make sure the trigger button element exists before calling makeMenuAccessible.`);\n    return { openMenu: () => {}, closeMenu: () => {}, cleanup: () => {} };\n  }\n\n\n  const handlerMap = new Map<HTMLElement, (event: KeyboardEvent) => void>();\n  const submenuInstances = new Map<string, ReturnType<typeof makeMenuAccessible>>();\n\n  let cachedItems: NodeListOfHTMLElement | null = null;\n  function getItems() {\n    if (!cachedItems) {\n      cachedItems = menuDiv.querySelectorAll(`:scope > .${menuItemsClass}`) as NodeListOfHTMLElement;\n    }\n    return cachedItems;\n  }\n\n  function setAria(isOpen: boolean) {\n    triggerButton.setAttribute(\"aria-expanded\", isOpen ? \"true\" : \"false\");\n  }\n\n  function openSubmenu(submenuId: string) {\n    let submenuInstance = submenuInstances.get(submenuId);\n    if (!submenuInstance) {\n      const submenuTrigger = menuDiv.querySelector(`[aria-controls=\"${submenuId}\"]`) as HTMLElement;\n      if (!submenuTrigger) {\n        console.error(`[aria-ease] Submenu trigger with aria-controls=\"${submenuId}\" not found in menu \"${menuId}\".`);\n        return;\n      }\n\n      // Ensure the trigger has an ID for proper ARIA references\n      if (!submenuTrigger.id) {\n        const generatedId = `trigger-${submenuId}`;\n        submenuTrigger.id = generatedId;\n        console.warn(`[aria-ease] Submenu trigger for \"${submenuId}\" had no ID. Auto-generated ID: \"${generatedId}\".`);\n      }\n\n      // Verify the submenu element exists before creating instance\n      const submenuElement = document.querySelector(`#${submenuId}`);\n      if (!submenuElement) {\n        console.error(`[aria-ease] Submenu element with id=\"${submenuId}\" not found. Cannot create submenu instance.`);\n        return;\n      }\n\n      submenuInstance = makeMenuAccessible({\n        menuId: submenuId,\n        menuItemsClass: menuItemsClass,\n        triggerId: submenuTrigger.id\n      });\n      submenuInstances.set(submenuId, submenuInstance);\n    }\n    \n    submenuInstance.openMenu();\n  }\n\n  function closeSubmenu() {\n    closeMenu();\n  }\n\n  function addListeners() {\n    const menuItems = getItems();\n    menuItems.forEach((menuItem: HTMLElement, index: number) => {\n      if (!handlerMap.has(menuItem)) {\n        const handler = (event: KeyboardEvent) => handleKeyPress(\n          event, \n          menuItems, \n          index, \n          menuDiv, \n          triggerButton,\n          openSubmenu,\n          closeSubmenu\n        );\n        menuItem.addEventListener(\"keydown\", handler);\n        handlerMap.set(menuItem, handler);\n      } \n    });\n  }\n\n  function removeListeners() {\n    const menuItems = getItems();\n    menuItems.forEach((menuItem: HTMLElement) => {\n      const handler = handlerMap.get(menuItem);\n      if (handler) {\n        menuItem.removeEventListener(\"keydown\", handler);\n        handlerMap.delete(menuItem);\n      }\n    });\n  }\n\n  function openMenu() {\n    menuDiv.style.display = \"block\";\n    setAria(true);\n    addListeners();\n  \n    const menuItems = getItems();\n    if (menuItems.length > 0) menuItems[0].focus();\n  }\n\n  function closeMenu() {\n    removeListeners();\n    menuDiv.style.display = \"none\";\n    setAria(false);\n    triggerButton.focus();\n  }\n\n  function cleanup() {\n    removeListeners();\n    \n    // Close menu and reset ARIA attributes\n    menuDiv.style.display = \"none\";\n    setAria(false);\n    \n    submenuInstances.forEach(instance => instance.cleanup());\n    submenuInstances.clear();\n  }\n\n  function refresh() {\n    cachedItems = null;\n  }\n\n  return { openMenu, closeMenu, cleanup, refresh };\n}"]}
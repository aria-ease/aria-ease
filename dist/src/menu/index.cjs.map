{"version":3,"sources":["../../../src/utils/handleKeyPress/handleKeyPress.ts","../../../src/menu/src/makeMenuAccessible/makeMenuAccessible.ts"],"names":[],"mappings":";;;AAGA,SAAS,YAAY,EAAA,EAA0B;AAC3C,EAAA,IAAI,EAAA,CAAG,OAAA,KAAY,OAAA,EAAS,OAAO,KAAA;AACnC,EAAA,MAAM,OAAQ,EAAA,CAAwB,IAAA;AACtC,EAAA,OAAO,CAAC,QAAQ,OAAA,EAAS,UAAA,EAAY,OAAO,QAAQ,CAAA,CAAE,SAAS,IAAI,CAAA;AACvE;AAEA,SAAS,WAAW,EAAA,EAA0B;AAC1C,EAAA,OAAO,GAAG,OAAA,KAAY,UAAA;AAC1B;AAEO,SAAS,eAAe,EAAA,EAA0B;AACrD,EAAA,OAAO,EAAA,CAAG,OAAA,KAAY,QAAA,IAAa,EAAA,CAAG,OAAA,KAAY,OAAA,IAAW,CAAC,QAAA,EAAU,QAAA,EAAU,OAAO,CAAA,CAAE,QAAA,CAAU,GAAwB,IAAI,CAAA;AACrI;AAEO,SAAS,OAAO,EAAA,EAA0B;AAC7C,EAAA,OAAO,GAAG,OAAA,KAAY,GAAA;AAC1B;AAEA,SAAS,SAAA,CAAU,YAAA,EAAqC,YAAA,EAAsB,SAAA,EAAmB;AAC7F,EAAA,MAAM,MAAM,YAAA,CAAa,MAAA;AACzB,EAAA,MAAM,SAAA,GAAA,CAAa,YAAA,GAAe,SAAA,GAAY,GAAA,IAAO,GAAA;AACrD,EAAA,YAAA,CAAa,IAAA,CAAK,SAAS,CAAA,CAAE,KAAA,EAAM;AACvC;AAEA,SAAS,0BAA0B,EAAA,EAA0B;AACzD,EAAA,OAAO,EAAA,CAAG,aAAa,mBAAmB,CAAA,KAAM,QAAQ,EAAA,CAAG,YAAA,CAAa,mBAAmB,CAAA,KAAM,MAAA;AACrG;AAEA,SAAS,wBAAA,CAAyB,aAA0B,iBAAA,EAAgC;AACxF,EAAA,WAAA,CAAY,MAAM,OAAA,GAAU,MAAA;AAC5B,EAAA,MAAM,mBAAA,GAAsB,iBAAA,CAAkB,YAAA,CAAa,IAAI,CAAA;AAC/D,EAAA,IAAI,CAAC,mBAAA,EAAqB;AACtB,IAAA,OAAA,CAAQ,MAAM,4FAA4F,CAAA;AAC1G,IAAA;AAAA,EACJ;AACA,EAAA,iBAAA,CAAkB,YAAA,CAAa,iBAAiB,OAAO,CAAA;AAC3D;AAEA,SAAS,WAAW,QAAA,EAAgC;AAChD,EAAA,OAAO,QAAA,CAAS,aAAa,eAAe,CAAA,KAAM,UAAU,QAAA,CAAS,YAAA,CAAa,eAAe,CAAA,KAAM,MAAA;AAC3G;AAEA,SAAS,aAAa,QAAA,EAAsC;AACxD,EAAA,OAAO,QAAA,CAAS,aAAa,eAAe,CAAA;AAChD;AAGO,SAAS,eACZ,KAAA,EACA,YAAA,EACA,kBACA,cAAA,EACA,aAAA,EACA,aACA,YAAA,EACI;AACJ,EAAA,MAAM,SAAA,GAAY,YAAA,CAAa,IAAA,CAAK,gBAAgB,CAAA;AACpD,EAAA,QAAQ,MAAM,GAAA;AAAK,IACf,KAAK,SAAA;AAAA,IACL,KAAK,WAAA,EAAa;AACd,MAAA,IAAG,KAAA,CAAM,GAAA,KAAQ,WAAA,IAAe,cAAA,IAAkB,YAAA,EAAc;AAC5D,QAAA,MAAM,UAAA,GAAa,cAAA,CAAe,YAAA,CAAa,iBAAiB,CAAA;AAChE,QAAA,IAAI,UAAA,EAAY;AACZ,UAAA,MAAM,aAAA,GAAgB,QAAA,CAAS,cAAA,CAAe,UAAU,CAAA;AACxD,UAAA,IAAI,aAAA,IAAiB,aAAA,CAAc,YAAA,CAAa,MAAM,MAAM,UAAA,EAAY;AACpE,YAAA,KAAA,CAAM,cAAA,EAAe;AACrB,YAAA,YAAA,EAAa;AACb,YAAA,aAAA,CAAc,KAAA,EAAM;AACpB,YAAA;AAAA,UACJ;AAAA,QACJ;AAAA,MACJ;AAEA,MAAA,IAAI,CAAC,WAAA,CAAY,SAAS,KAAK,CAAC,UAAA,CAAW,SAAS,CAAA,EAAG;AACnD,QAAA,KAAA,CAAM,cAAA,EAAe;AACrB,QAAA,SAAA,CAAU,YAAA,EAAc,kBAAkB,EAAE,CAAA;AAAA,MAChD,WAAW,WAAA,CAAY,SAAS,CAAA,IAAK,UAAA,CAAW,SAAS,CAAA,EAAG;AACxD,QAAA,MAAM,cAAe,SAAA,CAAqD,cAAA;AAC1E,QAAA,IAAI,gBAAgB,CAAA,EAAG;AACnB,UAAA,KAAA,CAAM,cAAA,EAAe;AACrB,UAAA,SAAA,CAAU,YAAA,EAAc,kBAAkB,EAAE,CAAA;AAAA,QAChD;AAAA,MACJ;AACA,MAAA;AAAA,IACJ;AAAA,IACA,KAAK,WAAA;AAAA,IACL,KAAK,YAAA,EAAc;AACf,MAAA,IAAG,MAAM,GAAA,KAAQ,YAAA,IAAgB,UAAA,CAAW,SAAS,KAAK,WAAA,EAAa;AACnE,QAAA,KAAA,CAAM,cAAA,EAAe;AACrB,QAAA,MAAM,SAAA,GAAY,aAAa,SAAS,CAAA;AACxC,QAAA,IAAI,SAAA,EAAW;AACX,UAAA,WAAA,CAAY,SAAS,CAAA;AACrB,UAAA;AAAA,QACJ;AAAA,MACJ;AAEA,MAAA,IAAI,CAAC,WAAA,CAAY,SAAS,KAAK,CAAC,UAAA,CAAW,SAAS,CAAA,EAAG;AACnD,QAAA,KAAA,CAAM,cAAA,EAAe;AACrB,QAAA,SAAA,CAAU,YAAA,EAAc,kBAAkB,CAAC,CAAA;AAAA,MAC/C,WAAW,WAAA,CAAY,SAAS,CAAA,IAAK,UAAA,CAAW,SAAS,CAAA,EAAG;AACxD,QAAA,MAAM,QAAS,SAAA,CAAqD,KAAA;AACpE,QAAA,MAAM,YAAa,SAAA,CAAqD,cAAA;AACxE,QAAA,IAAI,SAAA,KAAc,MAAM,MAAA,EAAQ;AAC5B,UAAA,KAAA,CAAM,cAAA,EAAe;AACrB,UAAA,SAAA,CAAU,YAAA,EAAc,kBAAkB,CAAC,CAAA;AAAA,QAC/C;AAAA,MACJ;AACA,MAAA;AAAA,IACJ;AAAA,IACA,KAAK,QAAA,EAAU;AACX,MAAA,KAAA,CAAM,cAAA,EAAe;AACrB,MAAA,IAAI,kBAAkB,aAAA,EAAe;AACjC,QAAA,IAAI,gBAAA,CAAiB,cAAc,CAAA,CAAE,OAAA,KAAY,OAAA,EAAS;AACtD,UAAA,wBAAA,CAAyB,gBAAgB,aAAa,CAAA;AAAA,QAC1D;AACA,QAAA,aAAA,CAAc,KAAA,EAAM;AAAA,MACxB;AACA,MAAA;AAAA,IACJ;AAAA,IACA,KAAK,OAAA;AAAA,IACL,KAAK,GAAA,EAAK;AACN,MAAA,IAAI,CAAC,cAAA,CAAe,SAAS,CAAA,IAAK,CAAC,OAAO,SAAS,CAAA,IAAK,yBAAA,CAA0B,SAAS,CAAA,EAAG;AAC1F,QAAA,KAAA,CAAM,cAAA,EAAe;AACrB,QAAA,SAAA,CAAU,KAAA,EAAM;AAAA,MACpB,CAAA,MAAA,IAAW,cAAA,CAAe,SAAS,CAAA,EAAG;AAClC,QAAA,KAAA,CAAM,cAAA,EAAe;AACrB,QAAA,SAAA,CAAU,KAAA,EAAM;AAAA,MACpB;AACA,MAAA;AAAA,IACJ;AAEI;AAEZ;;;AC7HO,SAAS,kBAAA,CAAmB,EAAE,MAAA,EAAQ,cAAA,EAAgB,WAAU,EAAiE;AACtI,EAAA,MAAM,OAAA,GAAU,QAAA,CAAS,aAAA,CAAc,CAAA,CAAA,EAAI,MAAM,CAAA,CAAE,CAAA;AACnD,EAAA,IAAI,CAAC,OAAA,EAAS;AACZ,IAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,6BAAA,EAAgC,MAAM,CAAA,iFAAA,CAAmF,CAAA;AACvI,IAAA,OAAO,EAAE,UAAU,MAAM;AAAA,IAAC,CAAA,EAAG,WAAW,MAAM;AAAA,IAAC,CAAA,EAAG,SAAS,MAAM;AAAA,IAAC,CAAA,EAAE;AAAA,EACtE;AAEA,EAAA,MAAM,aAAA,GAAgB,QAAA,CAAS,aAAA,CAAc,CAAA,CAAA,EAAI,SAAS,CAAA,CAAE,CAAA;AAC5D,EAAA,IAAI,CAAC,aAAA,EAAe;AAClB,IAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,6BAAA,EAAgC,SAAS,CAAA,2FAAA,CAA6F,CAAA;AACpJ,IAAA,OAAO,EAAE,UAAU,MAAM;AAAA,IAAC,CAAA,EAAG,WAAW,MAAM;AAAA,IAAC,CAAA,EAAG,SAAS,MAAM;AAAA,IAAC,CAAA,EAAE;AAAA,EACtE;AAGA,EAAA,MAAM,UAAA,uBAAiB,GAAA,EAAiD;AACxE,EAAA,MAAM,gBAAA,uBAAuB,GAAA,EAAmD;AAEhF,EAAA,IAAI,WAAA,GAA4C,IAAA;AAChD,EAAA,SAAS,QAAA,GAAW;AAClB,IAAA,IAAI,CAAC,WAAA,EAAa;AAChB,MAAA,WAAA,GAAc,OAAA,CAAQ,gBAAA,CAAiB,CAAA,UAAA,EAAa,cAAc,CAAA,CAAE,CAAA;AAAA,IACtE;AACA,IAAA,OAAO,WAAA;AAAA,EACT;AAEA,EAAA,SAAS,QAAQ,MAAA,EAAiB;AAChC,IAAA,aAAA,CAAc,YAAA,CAAa,eAAA,EAAiB,MAAA,GAAS,MAAA,GAAS,OAAO,CAAA;AAAA,EACvE;AAEA,EAAA,SAAS,YAAY,SAAA,EAAmB;AACtC,IAAA,IAAI,eAAA,GAAkB,gBAAA,CAAiB,GAAA,CAAI,SAAS,CAAA;AACpD,IAAA,IAAI,CAAC,eAAA,EAAiB;AACpB,MAAA,MAAM,cAAA,GAAiB,OAAA,CAAQ,aAAA,CAAc,CAAA,gBAAA,EAAmB,SAAS,CAAA,EAAA,CAAI,CAAA;AAC7E,MAAA,IAAI,CAAC,cAAA,EAAgB;AACnB,QAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,gDAAA,EAAmD,SAAS,CAAA,qBAAA,EAAwB,MAAM,CAAA,EAAA,CAAI,CAAA;AAC5G,QAAA;AAAA,MACF;AAGA,MAAA,IAAI,CAAC,eAAe,EAAA,EAAI;AACtB,QAAA,MAAM,WAAA,GAAc,WAAW,SAAS,CAAA,CAAA;AACxC,QAAA,cAAA,CAAe,EAAA,GAAK,WAAA;AACpB,QAAA,OAAA,CAAQ,IAAA,CAAK,CAAA,iCAAA,EAAoC,SAAS,CAAA,iCAAA,EAAoC,WAAW,CAAA,EAAA,CAAI,CAAA;AAAA,MAC/G;AAGA,MAAA,MAAM,cAAA,GAAiB,QAAA,CAAS,aAAA,CAAc,CAAA,CAAA,EAAI,SAAS,CAAA,CAAE,CAAA;AAC7D,MAAA,IAAI,CAAC,cAAA,EAAgB;AACnB,QAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,qCAAA,EAAwC,SAAS,CAAA,4CAAA,CAA8C,CAAA;AAC7G,QAAA;AAAA,MACF;AAEA,MAAA,eAAA,GAAkB,kBAAA,CAAmB;AAAA,QACnC,MAAA,EAAQ,SAAA;AAAA,QACR,cAAA;AAAA,QACA,WAAW,cAAA,CAAe;AAAA,OAC3B,CAAA;AACD,MAAA,gBAAA,CAAiB,GAAA,CAAI,WAAW,eAAe,CAAA;AAAA,IACjD;AAEA,IAAA,eAAA,CAAgB,QAAA,EAAS;AAAA,EAC3B;AAEA,EAAA,SAAS,YAAA,GAAe;AACtB,IAAA,SAAA,EAAU;AAAA,EACZ;AAEA,EAAA,SAAS,YAAA,GAAe;AACtB,IAAA,MAAM,YAAY,QAAA,EAAS;AAC3B,IAAA,SAAA,CAAU,OAAA,CAAQ,CAAC,QAAA,EAAuB,KAAA,KAAkB;AAC1D,MAAA,IAAI,CAAC,UAAA,CAAW,GAAA,CAAI,QAAQ,CAAA,EAAG;AAC7B,QAAA,MAAM,OAAA,GAAU,CAAC,KAAA,KAAyB,cAAA;AAAA,UACxC,KAAA;AAAA,UACA,SAAA;AAAA,UACA,KAAA;AAAA,UACA,OAAA;AAAA,UACA,aAAA;AAAA,UACA,WAAA;AAAA,UACA;AAAA,SACF;AACA,QAAA,QAAA,CAAS,gBAAA,CAAiB,WAAW,OAAO,CAAA;AAC5C,QAAA,UAAA,CAAW,GAAA,CAAI,UAAU,OAAO,CAAA;AAAA,MAClC;AAAA,IACF,CAAC,CAAA;AAAA,EACH;AAEA,EAAA,SAAS,eAAA,GAAkB;AACzB,IAAA,MAAM,YAAY,QAAA,EAAS;AAC3B,IAAA,SAAA,CAAU,OAAA,CAAQ,CAAC,QAAA,KAA0B;AAC3C,MAAA,MAAM,OAAA,GAAU,UAAA,CAAW,GAAA,CAAI,QAAQ,CAAA;AACvC,MAAA,IAAI,OAAA,EAAS;AACX,QAAA,QAAA,CAAS,mBAAA,CAAoB,WAAW,OAAO,CAAA;AAC/C,QAAA,UAAA,CAAW,OAAO,QAAQ,CAAA;AAAA,MAC5B;AAAA,IACF,CAAC,CAAA;AAAA,EACH;AAEA,EAAA,SAAS,QAAA,GAAW;AAClB,IAAA,OAAA,CAAQ,MAAM,OAAA,GAAU,OAAA;AACxB,IAAA,OAAA,CAAQ,IAAI,CAAA;AACZ,IAAA,YAAA,EAAa;AAEb,IAAA,MAAM,YAAY,QAAA,EAAS;AAC3B,IAAA,IAAI,UAAU,MAAA,GAAS,CAAA,EAAG,SAAA,CAAU,CAAC,EAAE,KAAA,EAAM;AAAA,EAC/C;AAEA,EAAA,SAAS,SAAA,GAAY;AACnB,IAAA,eAAA,EAAgB;AAChB,IAAA,OAAA,CAAQ,MAAM,OAAA,GAAU,MAAA;AACxB,IAAA,OAAA,CAAQ,KAAK,CAAA;AACb,IAAA,aAAA,CAAc,KAAA,EAAM;AAAA,EACtB;AAEA,EAAA,SAAS,OAAA,GAAU;AACjB,IAAA,eAAA,EAAgB;AAGhB,IAAA,OAAA,CAAQ,MAAM,OAAA,GAAU,MAAA;AACxB,IAAA,OAAA,CAAQ,KAAK,CAAA;AAEb,IAAA,gBAAA,CAAiB,OAAA,CAAQ,CAAA,QAAA,KAAY,QAAA,CAAS,OAAA,EAAS,CAAA;AACvD,IAAA,gBAAA,CAAiB,KAAA,EAAM;AAAA,EACzB;AAEA,EAAA,SAAS,OAAA,GAAU;AACjB,IAAA,WAAA,GAAc,IAAA;AAAA,EAChB;AAEA,EAAA,OAAO,EAAE,QAAA,EAAU,SAAA,EAAW,OAAA,EAAS,OAAA,EAAQ;AACjD","file":"index.cjs","sourcesContent":["import { NodeListOfHTMLElement } from \"../../../Types\";\n\n\nfunction isTextInput(el: HTMLElement): boolean {\n    if (el.tagName !== \"INPUT\") return false;\n    const type = (el as HTMLInputElement).type;\n    return [\"text\", \"email\", \"password\", \"tel\", \"number\"].includes(type);\n}\n\nfunction isTextArea(el: HTMLElement): boolean {\n    return el.tagName === \"TEXTAREA\";\n}\n\nexport function isNativeButton(el: HTMLElement): boolean {\n    return el.tagName === \"BUTTON\" || (el.tagName === \"INPUT\" && [\"button\", \"submit\", \"reset\"].includes((el as HTMLInputElement).type));\n}\n\nexport function isLink(el: HTMLElement): boolean {\n    return el.tagName === \"A\";\n}\n\nfunction moveFocus(elementItems: NodeListOfHTMLElement, currentIndex: number, direction: -1 | 1) {\n    const len = elementItems.length;\n    const nextIndex = (currentIndex + direction + len) % len;\n    elementItems.item(nextIndex).focus();\n}\n\nfunction isClickableButNotSemantic(el: HTMLElement): boolean {\n    return el.getAttribute(\"data-custom-click\") !== null && el.getAttribute(\"data-custom-click\") !== undefined;\n}\n\nfunction handleMenuEscapeKeyPress(menuElement: HTMLElement, menuTriggerButton: HTMLElement) {\n    menuElement.style.display = \"none\";\n    const menuTriggerButtonId = menuTriggerButton.getAttribute(\"id\");\n    if (!menuTriggerButtonId) {\n        console.error(\"[aria-ease] Menu trigger button must have an id attribute to properly set aria attributes.\");\n        return;\n    }\n    menuTriggerButton.setAttribute(\"aria-expanded\", \"false\");\n}\n\nfunction hasSubmenu(menuItem: HTMLElement): boolean {\n    return menuItem.getAttribute(\"aria-haspopup\") === \"true\" || menuItem.getAttribute(\"aria-haspopup\") === \"menu\";\n}\n\nfunction getSubmenuId(menuItem: HTMLElement): string | null {\n    return menuItem.getAttribute(\"aria-controls\");\n}\n\n\nexport function handleKeyPress(\n    event: KeyboardEvent,\n    elementItems: NodeListOfHTMLElement,\n    elementItemIndex: number,\n    menuElementDiv?: HTMLElement,\n    triggerButton?: HTMLElement,\n    openSubmenu?: (submenuId: string) => void,\n    closeSubmenu?: () => void\n): void {\n    const currentEl = elementItems.item(elementItemIndex);\n    switch (event.key) {\n        case \"ArrowUp\":\n        case \"ArrowLeft\": {\n            if(event.key === \"ArrowLeft\" && menuElementDiv && closeSubmenu) {\n                const labelledBy = menuElementDiv.getAttribute(\"aria-labelledby\");\n                if (labelledBy) {\n                    const parentTrigger = document.getElementById(labelledBy);\n                    if (parentTrigger && parentTrigger.getAttribute(\"role\") === \"menuitem\") {\n                        event.preventDefault();\n                        closeSubmenu();\n                        parentTrigger.focus();\n                        return;\n                    }\n                }\n            }\n\n            if (!isTextInput(currentEl) && !isTextArea(currentEl)) {\n                event.preventDefault();\n                moveFocus(elementItems, elementItemIndex, -1);\n            } else if (isTextInput(currentEl) || isTextArea(currentEl)) {\n                const cursorStart = (currentEl as HTMLInputElement | HTMLTextAreaElement).selectionStart;\n                if (cursorStart === 0) {\n                    event.preventDefault();\n                    moveFocus(elementItems, elementItemIndex, -1);\n                }\n            }\n            break;\n        }\n        case \"ArrowDown\":\n        case \"ArrowRight\": {\n            if(event.key === \"ArrowRight\" && hasSubmenu(currentEl) && openSubmenu) {\n                event.preventDefault();\n                const submenuId = getSubmenuId(currentEl);\n                if (submenuId) {\n                    openSubmenu(submenuId);\n                    return;\n                }\n            }\n            \n            if (!isTextInput(currentEl) && !isTextArea(currentEl)) {\n                event.preventDefault();\n                moveFocus(elementItems, elementItemIndex, 1);\n            } else if (isTextInput(currentEl) || isTextArea(currentEl)) {\n                const value = (currentEl as HTMLInputElement | HTMLTextAreaElement).value;\n                const cursorEnd = (currentEl as HTMLInputElement | HTMLTextAreaElement).selectionStart;\n                if (cursorEnd === value.length) {\n                    event.preventDefault();\n                    moveFocus(elementItems, elementItemIndex, 1);\n                }\n            }\n            break;\n        }\n        case \"Escape\": {\n            event.preventDefault();\n            if (menuElementDiv && triggerButton) {\n                if (getComputedStyle(menuElementDiv).display === \"block\") {\n                    handleMenuEscapeKeyPress(menuElementDiv, triggerButton);\n                }\n                triggerButton.focus();\n            }\n            break;\n        }\n        case \"Enter\":\n        case \" \": {\n            if (!isNativeButton(currentEl) && !isLink(currentEl) && isClickableButNotSemantic(currentEl)) { \n                event.preventDefault();\n                currentEl.click();\n            } else if (isNativeButton(currentEl)) {\n                event.preventDefault();\n                currentEl.click();\n            }\n            break;\n        }\n        default:\n            break;\n    }\n}","/**\n  * Adds keyboard interaction to toggle menu. The menu traps focus and can be interacted with using the keyboard. The first interactive item of the menu has focus when menu open.\n  * @param {string} menuId - The id of the menu.\n  * @param {string} menuItemsClass - The class of the items that are children of the menu.\n  * @param {string} triggerId - The id of the button that triggers the menu.\n*/\n\nimport { handleKeyPress } from \"../../../utils/handleKeyPress/handleKeyPress\";\nimport { NodeListOfHTMLElement } from \"Types\";\n\n\nexport function makeMenuAccessible({ menuId, menuItemsClass, triggerId }: {menuId: string; menuItemsClass: string; triggerId: string;}) {\n  const menuDiv = document.querySelector(`#${menuId}`) as HTMLElement;\n  if (!menuDiv) {\n    console.error(`[aria-ease] Element with id=\"${menuId}\" not found. Make sure the menu element exists before calling makeMenuAccessible.`);\n    return { openMenu: () => {}, closeMenu: () => {}, cleanup: () => {} };\n  }\n\n  const triggerButton = document.querySelector(`#${triggerId}`) as HTMLElement;\n  if (!triggerButton) {\n    console.error(`[aria-ease] Element with id=\"${triggerId}\" not found. Make sure the trigger button element exists before calling makeMenuAccessible.`);\n    return { openMenu: () => {}, closeMenu: () => {}, cleanup: () => {} };\n  }\n\n\n  const handlerMap = new Map<HTMLElement, (event: KeyboardEvent) => void>();\n  const submenuInstances = new Map<string, ReturnType<typeof makeMenuAccessible>>();\n\n  let cachedItems: NodeListOfHTMLElement | null = null;\n  function getItems() {\n    if (!cachedItems) {\n      cachedItems = menuDiv.querySelectorAll(`:scope > .${menuItemsClass}`) as NodeListOfHTMLElement;\n    }\n    return cachedItems;\n  }\n\n  function setAria(isOpen: boolean) {\n    triggerButton.setAttribute(\"aria-expanded\", isOpen ? \"true\" : \"false\");\n  }\n\n  function openSubmenu(submenuId: string) {\n    let submenuInstance = submenuInstances.get(submenuId);\n    if (!submenuInstance) {\n      const submenuTrigger = menuDiv.querySelector(`[aria-controls=\"${submenuId}\"]`) as HTMLElement;\n      if (!submenuTrigger) {\n        console.error(`[aria-ease] Submenu trigger with aria-controls=\"${submenuId}\" not found in menu \"${menuId}\".`);\n        return;\n      }\n\n      // Ensure the trigger has an ID for proper ARIA references\n      if (!submenuTrigger.id) {\n        const generatedId = `trigger-${submenuId}`;\n        submenuTrigger.id = generatedId;\n        console.warn(`[aria-ease] Submenu trigger for \"${submenuId}\" had no ID. Auto-generated ID: \"${generatedId}\".`);\n      }\n\n      // Verify the submenu element exists before creating instance\n      const submenuElement = document.querySelector(`#${submenuId}`);\n      if (!submenuElement) {\n        console.error(`[aria-ease] Submenu element with id=\"${submenuId}\" not found. Cannot create submenu instance.`);\n        return;\n      }\n\n      submenuInstance = makeMenuAccessible({\n        menuId: submenuId,\n        menuItemsClass: menuItemsClass,\n        triggerId: submenuTrigger.id\n      });\n      submenuInstances.set(submenuId, submenuInstance);\n    }\n    \n    submenuInstance.openMenu();\n  }\n\n  function closeSubmenu() {\n    closeMenu();\n  }\n\n  function addListeners() {\n    const menuItems = getItems();\n    menuItems.forEach((menuItem: HTMLElement, index: number) => {\n      if (!handlerMap.has(menuItem)) {\n        const handler = (event: KeyboardEvent) => handleKeyPress(\n          event, \n          menuItems, \n          index, \n          menuDiv, \n          triggerButton,\n          openSubmenu,\n          closeSubmenu\n        );\n        menuItem.addEventListener(\"keydown\", handler);\n        handlerMap.set(menuItem, handler);\n      } \n    });\n  }\n\n  function removeListeners() {\n    const menuItems = getItems();\n    menuItems.forEach((menuItem: HTMLElement) => {\n      const handler = handlerMap.get(menuItem);\n      if (handler) {\n        menuItem.removeEventListener(\"keydown\", handler);\n        handlerMap.delete(menuItem);\n      }\n    });\n  }\n\n  function openMenu() {\n    menuDiv.style.display = \"block\";\n    setAria(true);\n    addListeners();\n  \n    const menuItems = getItems();\n    if (menuItems.length > 0) menuItems[0].focus();\n  }\n\n  function closeMenu() {\n    removeListeners();\n    menuDiv.style.display = \"none\";\n    setAria(false);\n    triggerButton.focus();\n  }\n\n  function cleanup() {\n    removeListeners();\n    \n    // Close menu and reset ARIA attributes\n    menuDiv.style.display = \"none\";\n    setAria(false);\n    \n    submenuInstances.forEach(instance => instance.cleanup());\n    submenuInstances.clear();\n  }\n\n  function refresh() {\n    cachedItems = null;\n  }\n\n  return { openMenu, closeMenu, cleanup, refresh };\n}"]}